name: Auto Dependency Update

on:
  schedule:
    # ë§¤ì£¼ ì›”ìš”ì¼ ì˜¤ì „ 9ì‹œ (UTC)ì— ì‹¤í–‰
    - cron: '0 9 * * 1'
  workflow_dispatch:
    inputs:
      package_type:
        description: 'Package type to update'
        required: false
        default: 'all'
        type: choice
        options:
          - all
          - frontend
          - backend

jobs:
  check-frontend-updates:
    name: Check Frontend Dependencies
    runs-on: ubuntu-latest
    if: github.event.inputs.package_type == 'all' || github.event.inputs.package_type == 'frontend' || github.event_name == 'schedule'
    
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
          cache-dependency-path: frontend/package-lock.json
      
      - name: Install dependencies
        working-directory: ./frontend
        run: npm ci
      
      - name: Check for outdated packages
        working-directory: ./frontend
        run: |
          npm outdated --json > outdated.json || true
          cat outdated.json
      
      - name: Create update PR
        uses: peter-evans/create-pull-request@v6
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          path: frontend
          commit-message: 'chore(frontend): Auto-update dependencies'
          title: 'ğŸ¤– Auto: Update frontend dependencies'
          body: |
            ## ğŸ”„ ìë™ ì˜ì¡´ì„± ì—…ë°ì´íŠ¸
            
            ì´ PRì€ ìë™ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.
            
            ### ì—…ë°ì´íŠ¸ëœ íŒ¨í‚¤ì§€:
            - ìì„¸í•œ ë‚´ìš©ì€ ì²´í¬ë¦¬ìŠ¤íŠ¸ë¥¼ í™•ì¸í•˜ì„¸ìš”.
            
            ### í…ŒìŠ¤íŠ¸:
            - [ ] ë¡œì»¬ì—ì„œ ë¹Œë“œ í™•ì¸
            - [ ] í…ŒìŠ¤íŠ¸ ì‹¤í–‰
            - [ ] ìˆ˜ë™ ê²€ì¦
            
            ### ì£¼ì˜ì‚¬í•­:
            - ì£¼ìš” ë²„ì „ ì—…ë°ì´íŠ¸ëŠ” ìˆ˜ë™ ê²€í† ê°€ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            - Breaking changesê°€ ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.
          branch: auto-update/frontend-deps
          delete-branch: true

  check-backend-updates:
    name: Check Backend Dependencies
    runs-on: ubuntu-latest
    if: github.event.inputs.package_type == 'all' || github.event.inputs.package_type == 'backend' || github.event_name == 'schedule'
    
    steps:
      - uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Check for outdated packages
        working-directory: ./backend
        run: |
          pip install pip-review || true
          pip-review --local --auto || true
          # ë˜ëŠ” pip list --outdated
      
      - name: Create update PR
        uses: peter-evans/create-pull-request@v6
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          path: backend
          commit-message: 'chore(backend): Auto-update dependencies'
          title: 'ğŸ¤– Auto: Update backend dependencies'
          body: |
            ## ğŸ”„ ìë™ ì˜ì¡´ì„± ì—…ë°ì´íŠ¸
            
            ì´ PRì€ ìë™ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.
            
            ### ì—…ë°ì´íŠ¸ëœ íŒ¨í‚¤ì§€:
            - ìì„¸í•œ ë‚´ìš©ì€ ì²´í¬ë¦¬ìŠ¤íŠ¸ë¥¼ í™•ì¸í•˜ì„¸ìš”.
            
            ### í…ŒìŠ¤íŠ¸:
            - [ ] ë¡œì»¬ì—ì„œ ë¹Œë“œ í™•ì¸
            - [ ] í…ŒìŠ¤íŠ¸ ì‹¤í–‰
            - [ ] ìˆ˜ë™ ê²€ì¦

