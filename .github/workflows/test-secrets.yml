name: Test GitHub Secrets

on:
  workflow_dispatch:

jobs:
  test-backend-secrets:
    name: Test Backend Secrets
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Test Backend SSH Connection
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ secrets.BACKEND_HOST }}
          username: ${{ secrets.BACKEND_USER }}
          key: ${{ secrets.BACKEND_SSH_KEY }}
          port: ${{ secrets.BACKEND_SSH_PORT || 22 }}
          script: |
            echo "âœ… ë°±ì—”ë“œ ì„œë²„ SSH ì—°ê²° ì„±ê³µ!"
            echo "ì„œë²„ ì •ë³´:"
            hostname
            whoami
            pwd
            echo "LIMEN ë””ë ‰í† ë¦¬ í™•ì¸:"
            if [ -d "/home/darc0/LIMEN" ]; then
              echo "âœ… /home/darc0/LIMEN ë””ë ‰í† ë¦¬ ì¡´ìž¬"
              ls -la /home/darc0/LIMEN | head -10
            else
              echo "âŒ /home/darc0/LIMEN ë””ë ‰í† ë¦¬ ì—†ìŒ"
            fi
      
      - name: Test Backend Health
        if: success()
        run: |
          BACKEND_URL="${{ secrets.BACKEND_URL || 'http://localhost:18443' }}"
          echo "ë°±ì—”ë“œ í—¬ìŠ¤ì²´í¬: $BACKEND_URL/api/health"
          curl -f -s "$BACKEND_URL/api/health" || echo "âš ï¸ í—¬ìŠ¤ì²´í¬ ì‹¤íŒ¨ (ì„œë¹„ìŠ¤ê°€ ì‹¤í–‰ ì¤‘ì´ì§€ ì•Šì„ ìˆ˜ ìžˆìŒ)"

  test-frontend-secrets:
    name: Test Frontend Secrets
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Test Frontend SSH Connection
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ secrets.FRONTEND_HOST }}
          username: ${{ secrets.FRONTEND_USER }}
          key: ${{ secrets.FRONTEND_SSH_KEY }}
          port: ${{ secrets.FRONTEND_SSH_PORT || 22 }}
          script: |
            echo "âœ… í”„ë¡ íŠ¸ì—”ë“œ ì„œë²„ SSH ì—°ê²° ì„±ê³µ!"
            echo "ì„œë²„ ì •ë³´:"
            hostname
            whoami
            pwd
            echo "LIMEN ë””ë ‰í† ë¦¬ í™•ì¸:"
            if [ -d "/home/darc/LIMEN" ]; then
              echo "âœ… /home/darc/LIMEN ë””ë ‰í† ë¦¬ ì¡´ìž¬"
              ls -la /home/darc/LIMEN | head -10
            else
              echo "âŒ /home/darc/LIMEN ë””ë ‰í† ë¦¬ ì—†ìŒ"
            fi
      
      - name: Test Frontend Health
        if: success()
        run: |
          FRONTEND_URL="${{ secrets.FRONTEND_URL || 'http://localhost:9444' }}"
          echo "í”„ë¡ íŠ¸ì—”ë“œ í—¬ìŠ¤ì²´í¬: $FRONTEND_URL"
          curl -f -s "$FRONTEND_URL" || echo "âš ï¸ í—¬ìŠ¤ì²´í¬ ì‹¤íŒ¨ (ì„œë¹„ìŠ¤ê°€ ì‹¤í–‰ ì¤‘ì´ì§€ ì•Šì„ ìˆ˜ ìžˆìŒ)"

  verify-secrets:
    name: Verify All Secrets
    runs-on: ubuntu-latest
    needs: [test-backend-secrets, test-frontend-secrets]
    
    steps:
      - name: Check Secrets Status
        run: |
          echo "## ðŸ” GitHub Secrets í™•ì¸ ê²°ê³¼" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ë°±ì—”ë“œ Secrets" >> $GITHUB_STEP_SUMMARY
          if [ -n "${{ secrets.BACKEND_HOST }}" ]; then
            echo "âœ… BACKEND_HOST: ì„¤ì •ë¨" >> $GITHUB_STEP_SUMMARY
          else
            echo "âŒ BACKEND_HOST: ì„¤ì • ì•ˆë¨" >> $GITHUB_STEP_SUMMARY
          fi
          if [ -n "${{ secrets.BACKEND_USER }}" ]; then
            echo "âœ… BACKEND_USER: ì„¤ì •ë¨" >> $GITHUB_STEP_SUMMARY
          else
            echo "âŒ BACKEND_USER: ì„¤ì • ì•ˆë¨" >> $GITHUB_STEP_SUMMARY
          fi
          if [ -n "${{ secrets.BACKEND_SSH_KEY }}" ]; then
            echo "âœ… BACKEND_SSH_KEY: ì„¤ì •ë¨" >> $GITHUB_STEP_SUMMARY
          else
            echo "âŒ BACKEND_SSH_KEY: ì„¤ì • ì•ˆë¨" >> $GITHUB_STEP_SUMMARY
          fi
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### í”„ë¡ íŠ¸ì—”ë“œ Secrets" >> $GITHUB_STEP_SUMMARY
          if [ -n "${{ secrets.FRONTEND_HOST }}" ]; then
            echo "âœ… FRONTEND_HOST: ì„¤ì •ë¨" >> $GITHUB_STEP_SUMMARY
          else
            echo "âŒ FRONTEND_HOST: ì„¤ì • ì•ˆë¨" >> $GITHUB_STEP_SUMMARY
          fi
          if [ -n "${{ secrets.FRONTEND_USER }}" ]; then
            echo "âœ… FRONTEND_USER: ì„¤ì •ë¨" >> $GITHUB_STEP_SUMMARY
          else
            echo "âŒ FRONTEND_USER: ì„¤ì • ì•ˆë¨" >> $GITHUB_STEP_SUMMARY
          fi
          if [ -n "${{ secrets.FRONTEND_SSH_KEY }}" ]; then
            echo "âœ… FRONTEND_SSH_KEY: ì„¤ì •ë¨" >> $GITHUB_STEP_SUMMARY
          else
            echo "âŒ FRONTEND_SSH_KEY: ì„¤ì • ì•ˆë¨" >> $GITHUB_STEP_SUMMARY
          fi
          
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### í…ŒìŠ¤íŠ¸ ê²°ê³¼" >> $GITHUB_STEP_SUMMARY
          if [ "${{ needs.test-backend-secrets.result }}" == "success" ]; then
            echo "âœ… ë°±ì—”ë“œ SSH ì—°ê²°: ì„±ê³µ" >> $GITHUB_STEP_SUMMARY
          else
            echo "âŒ ë°±ì—”ë“œ SSH ì—°ê²°: ì‹¤íŒ¨" >> $GITHUB_STEP_SUMMARY
          fi
          if [ "${{ needs.test-frontend-secrets.result }}" == "success" ]; then
            echo "âœ… í”„ë¡ íŠ¸ì—”ë“œ SSH ì—°ê²°: ì„±ê³µ" >> $GITHUB_STEP_SUMMARY
          else
            echo "âŒ í”„ë¡ íŠ¸ì—”ë“œ SSH ì—°ê²°: ì‹¤íŒ¨" >> $GITHUB_STEP_SUMMARY
          fi







