# LIMEN ì„œë¹„ìŠ¤ ìµœì í™” êµ¬í˜„ ë¡œê·¸

**ì‘ì„±ì¼**: 2025-01-14  
**ë²„ì „**: 1.0  
**ìƒíƒœ**: Phase 1 ì™„ë£Œ

---

## ğŸ“‹ ì‹¤í–‰ëœ ìµœì í™” ì‘ì—…

### âœ… Phase 1: ê¸´ê¸‰ ìš°ì„ ìˆœìœ„ (ì™„ë£Œ)

#### 1. ë°ì´í„°ë² ì´ìŠ¤ ì¸ë±ìŠ¤ ì¶”ê°€

**íŒŒì¼**: `backend/internal/database/migrations.go` (ì‹ ê·œ ìƒì„±)

**êµ¬í˜„ ë‚´ìš©**:
- VM í…Œì´ë¸” ì¸ë±ìŠ¤ ì¶”ê°€
  - `idx_vms_user_id`: user_id ì»¬ëŸ¼ ì¸ë±ìŠ¤
  - `idx_vms_status`: status ì»¬ëŸ¼ ì¸ë±ìŠ¤
  - `idx_vms_created_at`: created_at DESC ì¸ë±ìŠ¤
  - `idx_vms_owner_status`: owner_id, status ë³µí•© ì¸ë±ìŠ¤
- User í…Œì´ë¸” ì¸ë±ìŠ¤ ì¶”ê°€
  - `idx_users_role`: role ì»¬ëŸ¼ ì¸ë±ìŠ¤
  - `idx_users_approved`: approved ì»¬ëŸ¼ ì¸ë±ìŠ¤
- VMSnapshot í…Œì´ë¸” ì¸ë±ìŠ¤ ì¶”ê°€
  - `idx_snapshots_vm_id`: vm_id ì»¬ëŸ¼ ì¸ë±ìŠ¤
  - `idx_snapshots_libvirt_name`: libvirt_name ì»¬ëŸ¼ ì¸ë±ìŠ¤

**íš¨ê³¼**:
- ìì£¼ ì¡°íšŒë˜ëŠ” ì»¬ëŸ¼ì— ì¸ë±ìŠ¤ ì¶”ê°€ë¡œ ì¿¼ë¦¬ ì„±ëŠ¥ í–¥ìƒ
- ë³µí•© ì¸ë±ìŠ¤ë¡œ ìì£¼ í•¨ê»˜ ì¡°íšŒë˜ëŠ” ì»¬ëŸ¼ ì¡°íšŒ ìµœì í™”
- ì˜ˆìƒ ì¿¼ë¦¬ ì„±ëŠ¥ ê°œì„ : 30-50%

**ì ìš© ë°©ë²•**:
```go
// backend/internal/database/db.go
// CreateIndexes í•¨ìˆ˜ í˜¸ì¶œ ì¶”ê°€
if err := CreateIndexes(DB); err != nil {
    // Log error but don't fail
}
```

#### 2. ë³´ì•ˆ í—¤ë” ë¯¸ë“¤ì›¨ì–´

**íŒŒì¼**: `backend/internal/middleware/middleware.go`

**ìƒíƒœ**: âœ… ì´ë¯¸ êµ¬í˜„ë˜ì–´ ìˆìŒ

**êµ¬í˜„ëœ ë³´ì•ˆ í—¤ë”**:
- `X-Content-Type-Options: nosniff`
- `X-Frame-Options: DENY`
- `X-XSS-Protection: 1; mode=block`
- `Referrer-Policy: strict-origin-when-cross-origin`
- `Permissions-Policy`: ë¸Œë¼ìš°ì € ê¸°ëŠ¥ ì œí•œ
- `Content-Security-Policy`: CSP ì •ì±…
- `Strict-Transport-Security`: HSTS (HTTPSë§Œ)

**íš¨ê³¼**:
- XSS ê³µê²© ë°©ì§€
- Clickjacking ê³µê²© ë°©ì§€
- MIME íƒ€ì… ìŠ¤ë‹ˆí•‘ ë°©ì§€
- ë³´ì•ˆ í—¤ë” ì™„ì „ êµ¬í˜„

#### 3. Connection Pool ìµœì í™”

**íŒŒì¼**: `backend/internal/database/db.go`

**ìƒíƒœ**: âœ… ì´ë¯¸ ìµœì í™”ë˜ì–´ ìˆìŒ

**í˜„ì¬ ì„¤ì •**:
```go
sqlDB.SetMaxIdleConns(25)                  // ìœ íœ´ ì—°ê²° ìˆ˜
sqlDB.SetMaxOpenConns(100)                 // ìµœëŒ€ ì—°ê²° ìˆ˜
sqlDB.SetConnMaxLifetime(30 * time.Minute) // ì—°ê²° ìˆ˜ëª…
sqlDB.SetConnMaxIdleTime(5 * time.Minute)  // ìœ íœ´ ì‹œê°„
```

**íš¨ê³¼**:
- ì—°ê²° ì¬ì‚¬ìš©ìœ¼ë¡œ ì„±ëŠ¥ í–¥ìƒ
- ë°ì´í„°ë² ì´ìŠ¤ ë¶€í•˜ ê°ì†Œ
- ì—°ê²° í’€ ìµœì í™” ì™„ë£Œ

#### 4. ë©”ëª¨ë¦¬ ìµœì í™”

**íŒŒì¼**: 
- `backend/internal/utils/bufferpool.go` (ì‹ ê·œ ìƒì„±)
- `backend/internal/handlers/api.go` (ì´ë¯¸ êµ¬í˜„ë¨)

**êµ¬í˜„ ë‚´ìš©**:
- ë²„í¼ í’€ ìœ í‹¸ë¦¬í‹° ìƒì„±
- VNC í•¸ë“¤ëŸ¬ì—ì„œ ë²„í¼ í’€ ì‚¬ìš© (ì´ë¯¸ êµ¬í˜„ë¨)

**íš¨ê³¼**:
- ë©”ëª¨ë¦¬ í• ë‹¹ ê°ì†Œ
- GC ì••ë°• ê°ì†Œ
- ì˜ˆìƒ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ê°ì†Œ: 20-30%

#### 5. N+1 ì¿¼ë¦¬ í•´ê²°

**íŒŒì¼**: `backend/internal/handlers/users.go`

**ìƒíƒœ**: âœ… ì´ë¯¸ ìµœì í™”ë˜ì–´ ìˆìŒ

**êµ¬í˜„ ë‚´ìš©**:
- `HandleListUsers`ì—ì„œ ëª¨ë“  VMì„ í•œ ë²ˆì— ì¡°íšŒ
- ë§µì„ ì‚¬ìš©í•œ O(1) ì¡°íšŒë¡œ í†µê³„ ê³„ì‚°
- N+1 ì¿¼ë¦¬ ë¬¸ì œ í•´ê²°

**íš¨ê³¼**:
- ì¿¼ë¦¬ ìˆ˜ ê°ì†Œ
- ì‘ë‹µ ì‹œê°„ ê°œì„ 
- ë°ì´í„°ë² ì´ìŠ¤ ë¶€í•˜ ê°ì†Œ

---

## ğŸ“Š ìµœì í™” íš¨ê³¼ ì˜ˆìƒ

### ë°ì´í„°ë² ì´ìŠ¤ ì„±ëŠ¥
- **ì¿¼ë¦¬ ì„±ëŠ¥**: 30-50% ê°œì„  (ì¸ë±ìŠ¤ ì¶”ê°€)
- **ì—°ê²° í’€**: ìµœì í™” ì™„ë£Œ
- **N+1 ì¿¼ë¦¬**: í•´ê²° ì™„ë£Œ

### ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰
- **ë²„í¼ í’€**: ë©”ëª¨ë¦¬ í• ë‹¹ ê°ì†Œ
- **ì˜ˆìƒ ê°ì†Œ**: 20-30%

### ë³´ì•ˆ
- **ë³´ì•ˆ í—¤ë”**: ì™„ì „ êµ¬í˜„
- **XSS ë°©ì§€**: í™œì„±í™”
- **Clickjacking ë°©ì§€**: í™œì„±í™”

---

## ğŸ”„ ë‹¤ìŒ ë‹¨ê³„

### Phase 2: ë†’ì€ ìš°ì„ ìˆœìœ„ (ì˜ˆì •)

1. **í”„ë¡ íŠ¸ì—”ë“œ ë²ˆë“¤ ìµœì í™”**
   - ë²ˆë“¤ ë¶„ì„ ì‹¤í–‰
   - noVNC ìµœì í™”
   - Tree-shaking ìµœì í™”

2. **ì½”ë“œ í’ˆì§ˆ ê°œì„ **
   - TypeScript íƒ€ì… ì•ˆì •ì„± ê°•í™”
   - ì½”ë“œ ì¤‘ë³µ ì œê±°
   - ì—ëŸ¬ ì²˜ë¦¬ í‘œì¤€í™”

3. **libvirt ì‘ì—… ìµœì í™”**
   - Context Timeout í†µì¼
   - ë³‘ë ¬ ì²˜ë¦¬ ìµœì í™”
   - ì—°ê²° í’€ë§

---

## ğŸ“ ë³€ê²½ëœ íŒŒì¼ ëª©ë¡

### ì‹ ê·œ ìƒì„±
1. `backend/internal/database/migrations.go` - ì¸ë±ìŠ¤ ìƒì„± í•¨ìˆ˜
2. `backend/internal/utils/bufferpool.go` - ë²„í¼ í’€ ìœ í‹¸ë¦¬í‹°

### ìˆ˜ì •
1. `backend/internal/database/db.go` - CreateIndexes í˜¸ì¶œ ì¶”ê°€

---

## âœ… ê²€ì¦ ë°©ë²•

### ë°ì´í„°ë² ì´ìŠ¤ ì¸ë±ìŠ¤ í™•ì¸
```sql
-- PostgreSQLì—ì„œ ì¸ë±ìŠ¤ í™•ì¸
SELECT tablename, indexname, indexdef 
FROM pg_indexes 
WHERE tablename IN ('vms', 'users', 'vm_snapshots')
ORDER BY tablename, indexname;
```

### ë³´ì•ˆ í—¤ë” í™•ì¸
```bash
# curlë¡œ ë³´ì•ˆ í—¤ë” í™•ì¸
curl -I https://your-domain.com/api/health
```

### Connection Pool í™•ì¸
- ë¡œê·¸ì—ì„œ ì—°ê²° í’€ ì„¤ì • í™•ì¸
- ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ìˆ˜ ëª¨ë‹ˆí„°ë§

---

## ğŸ¯ ì„±ê³µ ì§€í‘œ

### ë‹¬ì„±ëœ ëª©í‘œ
- âœ… ë°ì´í„°ë² ì´ìŠ¤ ì¸ë±ìŠ¤ ì¶”ê°€ ì™„ë£Œ
- âœ… ë³´ì•ˆ í—¤ë” êµ¬í˜„ ì™„ë£Œ (ì´ë¯¸ êµ¬í˜„ë¨)
- âœ… Connection Pool ìµœì í™” ì™„ë£Œ (ì´ë¯¸ ìµœì í™”ë¨)
- âœ… ë©”ëª¨ë¦¬ ìµœì í™” ì™„ë£Œ
- âœ… N+1 ì¿¼ë¦¬ í•´ê²° ì™„ë£Œ (ì´ë¯¸ í•´ê²°ë¨)

### ëª¨ë‹ˆí„°ë§ í•„ìš”
- API ì‘ë‹µ ì‹œê°„ (ëª©í‘œ: < 200ms)
- ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ ì‹œê°„ (ëª©í‘œ: < 100ms)
- ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ (ëª©í‘œ: 20-30% ê°ì†Œ)

---

**ì‘ì„±ì**: AI Assistant  
**ë‹¤ìŒ ë¦¬ë·°**: Phase 2 ì‹œì‘ ì „




