# 네트워크 구성 요약

## 서버 IP 주소 정보

### 프론트엔드 서버
- **내부망 IP**: `10.0.0.10` (enp1s0)
  - 용도: 백엔드와 내부 통신
- **인터넷 IP**: `14.54.57.159` (enp3s0)
  - 용도: 외부 사용자 접근
  - 게이트웨이: `14.54.57.1`

### 백엔드 서버
- **인터넷 IP**: `61.73.245.105` (eth0)
  - 용도: 외부 접근용 (프론트엔드가 프록시하므로 직접 사용 안 함)
  - 게이트웨이: `61.73.245.1`
- **내부망 IP**: 
  - `10.0.0.100` (eth1) - 주요 내부망 IP, 프론트엔드와 통신용
  - `10.0.0.110` (eth0) - 추가 내부망 IP
- **리스닝**: `0.0.0.0:18443` (모든 인터페이스)

## 통신 경로

### 외부 사용자 → 프론트엔드 → 백엔드
```
외부 사용자
  ↓ HTTPS/HTTP
프론트엔드 인터넷 IP (14.54.57.159:443/80, enp3s0)
  ↓ Envoy 프록시
Next.js 프론트엔드 (127.0.0.1:9444)
  ↓ Next.js Middleware
  ↓ 내부망 (10.0.0.10 → 10.0.0.100:18443, enp1s0 → eth1)
백엔드 API (10.0.0.100:18443, eth1)
```

## 중요 설정

### Middleware (`middleware.ts`)
- 백엔드 호스트: `10.0.0.100` (내부망 IP)
- 백엔드 포트: `18443` (내부망 포트)

### Envoy (`envoy.yaml`)
- 백엔드 클러스터: `10.0.0.100:18443` (내부망)
- Agent 클러스터: `10.0.0.100:9000` (내부망)

### API 클라이언트
- 상대 경로 사용: `/api/*`
- Middleware가 내부망으로 프록시

## 확인 사항

### ✅ 올바른 설정
- 프론트엔드는 내부망 IP(10.0.0.10)로 백엔드(10.0.0.100)와 통신
- 외부 사용자는 프론트엔드 인터넷 IP(14.54.57.159)로 접근
- 모든 세션 통신은 내부망 포트(18443) 사용

### ❌ 잘못된 설정
- 백엔드 인터넷 IP(61.73.245.105)를 직접 사용
- 외부 포트를 사용
- 절대 URL에 인터넷 IP 포함




