# 사용자 관리 UI (Admin) 설명

> [← 홈](../../00-home.md) | [아카이브](../) | [Legacy 기록](./) | [사용자 관리 UI (Admin) 설명](./USER_MANAGEMENT_UI_EXPLANATION.md)

## ⚠️ 참고사항

이 문서는 과거 프로젝트 기록입니다. 현재 LIMEN 프로젝트는 위키 형식으로 재구성되었으며, 이 문서는 참고용으로 보관됩니다.

---

## 📋 현재 상황

### 현재 사용자 관리 상태
지금은 사용자 관리를 **데이터베이스에 직접 접근**하거나 **코드로만** 할 수 있습니다:

**현재 가능한 것**:
- ✅ 사용자 로그인 (`/api/auth/login`)
- ✅ 사용자 회원가입 (`/api/auth/register`) - 누구나 가입 가능
- ✅ Admin/User 역할 구분 (데이터베이스에 저장됨)

**현재 불가능한 것**:
- ❌ Admin이 사용자 목록을 웹에서 조회
- ❌ Admin이 사용자를 생성/수정/삭제
- ❌ Admin이 사용자 역할 변경 (User ↔ Admin)
- ❌ Admin이 사용자별 Quota 설정
- ❌ Admin이 사용자별 VM 목록 조회
- ❌ 사용자 비밀번호 초기화

**문제점**:
- 사용자 관리가 어려움 (DB 직접 접근 필요)
- Admin 권한을 주려면 코드 수정 필요
- 사용자별 리소스 관리 불가능

---

## 🎯 사용자 관리 UI란?

**Admin이 웹 인터페이스에서 모든 사용자를 관리할 수 있는 기능**

Admin으로 로그인하면, 별도의 관리 페이지에서:
- 사용자 목록 조회
- 새 사용자 생성
- 사용자 정보 수정
- 사용자 삭제 (비활성화)
- 역할 변경
- Quota 설정
- 사용자별 VM 목록 확인

---

## 💡 구체적인 사용 시나리오

### 시나리오 1: 새 직원 추가

**현재 (코드/DB 직접 접근)**:
```
1. 데이터베이스에 직접 접속
2. SQL 쿼리 실행:
   INSERT INTO users (username, password, role) 
   VALUES ('newuser', 'hashed_password', 'user');
3. 또는 코드 수정 후 재배포
```
→ **복잡하고 위험함** (SQL 실수 가능, 보안 문제)

**사용자 관리 UI 사용 (개선 후)**:
```
1. Admin으로 로그인
2. "사용자 관리" 메뉴 클릭
3. "새 사용자 추가" 버튼 클릭
4. 이름, 비밀번호 입력
5. 역할 선택 (User/Admin)
6. "생성" 버튼 클릭
→ 끝! (웹에서 바로 처리)
```

---

### 시나리오 2: 사용자에게 Admin 권한 부여

**현재**:
```
1. 데이터베이스 접속
2. SQL 실행:
   UPDATE users SET role = 'admin' WHERE username = 'john';
```
→ **DB 직접 접근 필요**

**사용자 관리 UI 사용**:
```
1. 사용자 목록에서 "john" 찾기
2. "역할 변경" 버튼 클릭
3. "Admin" 선택
4. "저장" 버튼 클릭
→ 끝!
```

---

### 시나리오 3: 사용자별 Quota 설정

**현재**:
- 모든 사용자가 같은 Quota 공유
- 개별 Quota 설정 불가능

**사용자 관리 UI 사용**:
```
1. 사용자 목록에서 "alice" 선택
2. "Quota 설정" 클릭
3. 개별 Quota 입력:
   - Max VMs: 10
   - Max CPU: 20
   - Max Memory: 40960 MB
4. "저장" 버튼 클릭
→ alice만의 개별 Quota 설정 완료
```

**장점**:
- VIP 사용자에게 더 많은 리소스 할당
- 일반 사용자는 제한된 리소스
- 유연한 리소스 관리

---

### 시나리오 4: 사용자별 VM 목록 확인

**현재**:
- 모든 VM이 한 목록에 표시됨
- 누가 어떤 VM을 사용하는지 확인 어려움

**사용자 관리 UI 사용**:
```
1. 사용자 목록에서 "bob" 선택
2. "VM 목록" 탭 클릭
3. bob이 생성한 모든 VM 표시:
   - web-server-01 (Running)
   - db-server-01 (Stopped)
   - dev-env-01 (Running)
```
→ **사용자별 리소스 사용량 파악 가능**

---

## 🎨 UI 예상 모습

### 사용자 관리 메인 페이지

```
┌─────────────────────────────────────────────────────┐
│  사용자 관리 (Admin Only)                            │
├─────────────────────────────────────────────────────┤
│  [+ 새 사용자 추가]  [사용자 검색: ________]         │
│                                                     │
│  ┌───────────────────────────────────────────────┐ │
│  │ 👤 admin                                       │ │
│  │   ID: 1 | 역할: Admin | 생성일: 2024-01-01    │ │
│  │   VM: 5개 | CPU: 20/100 | Memory: 40GB/100GB │ │
│  │   [상세] [역할변경] [Quota설정] [삭제]        │ │
│  └───────────────────────────────────────────────┘ │
│                                                     │
│  ┌───────────────────────────────────────────────┐ │
│  │ 👤 john                                        │ │
│  │   ID: 2 | 역할: User | 생성일: 2024-01-15    │ │
│  │   VM: 3개 | CPU: 8/50 | Memory: 16GB/50GB     │ │
│  │   [상세] [역할변경] [Quota설정] [삭제]        │ │
│  └───────────────────────────────────────────────┘ │
│                                                     │
│  ┌───────────────────────────────────────────────┐ │
│  │ 👤 alice                                       │ │
│  │   ID: 3 | 역할: User | 생성일: 2024-02-01    │ │
│  │   VM: 2개 | CPU: 4/30 | Memory: 8GB/30GB     │ │
│  │   [상세] [역할변경] [Quota설정] [삭제]        │ │
│  └───────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────┘
```

### 사용자 상세 모달

```
┌─────────────────────────────────────────┐
│  사용자 상세: john                    [X]│
├─────────────────────────────────────────┤
│  기본 정보:                              │
│  • ID: 2                                 │
│  • 사용자명: john                        │
│  • 역할: [▼ User] [Admin]               │
│  • 생성일: 2024-01-15 10:30:00          │
│  • 마지막 로그인: 2024-03-20 14:20:00   │
│                                         │
│  리소스 사용량:                          │
│  • VM: 3개 / 10개                       │
│  • CPU: 8 코어 / 50 코어                │
│  • Memory: 16 GB / 50 GB                │
│                                         │
│  Quota 설정:                            │
│  [Max VMs: 10] [Max CPU: 50] [Max Memory: 50GB]│
│  [저장]                                  │
│                                         │
│  VM 목록:                               │
│  • web-server-01 (Running)              │
│  • db-server-01 (Stopped)               │
│  • dev-env-01 (Running)                 │
│                                         │
│  [비밀번호 초기화] [사용자 삭제]        │
└─────────────────────────────────────────┘
```

### 새 사용자 추가 모달

```
┌─────────────────────────────────────────┐
│  새 사용자 추가                      [X]│
├─────────────────────────────────────────┤
│  사용자명:                              │
│  [newuser________________]              │
│                                         │
│  비밀번호:                              │
│  [****************]                     │
│                                         │
│  비밀번호 확인:                          │
│  [****************]                     │
│                                         │
│  역할:                                  │
│  ○ User  ● Admin                       │
│                                         │
│  초기 Quota 설정:                       │
│  • Max VMs: [10]                        │
│  • Max CPU: [20]                       │
│  • Max Memory: [40960] MB               │
│                                         │
│  [취소]  [사용자 생성]                  │
└─────────────────────────────────────────┘
```

---

## 🔧 기술적 구현 내용

### 1. 데이터베이스 모델 (이미 존재)

```go
type User struct {
    ID        uint      `gorm:"primaryKey"`
    Username  string    `gorm:"unique;not null"`
    Password  string    `gorm:"not null"`  // 해시된 비밀번호
    Role      UserRole  `gorm:"type:varchar(20);default:'user'"`
    CreatedAt time.Time
    UpdatedAt time.Time
    DeletedAt gorm.DeletedAt  // Soft delete
}
```

### 2. 새로운 API 엔드포인트 (Admin 전용)

```
GET    /api/admin/users              # 사용자 목록 조회
POST   /api/admin/users              # 새 사용자 생성
GET    /api/admin/users/{id}         # 사용자 상세 조회
PUT    /api/admin/users/{id}         # 사용자 정보 수정
DELETE /api/admin/users/{id}         # 사용자 삭제 (soft delete)
PUT    /api/admin/users/{id}/role    # 역할 변경
PUT    /api/admin/users/{id}/quota   # Quota 설정
GET    /api/admin/users/{id}/vms     # 사용자별 VM 목록
POST   /api/admin/users/{id}/reset-password  # 비밀번호 초기화
```

### 3. 프론트엔드 페이지

```
/admin/users          # 사용자 관리 메인 페이지
/admin/users/new      # 새 사용자 추가
/admin/users/{id}     # 사용자 상세 페이지
```

### 4. 권한 체크

모든 엔드포인트에 `middleware.Admin` 적용:
```go
api.HandleFunc("/admin/users", func(w http.ResponseWriter, r *http.Request) {
    adminMiddleware := middleware.Admin(cfg)
    adminMiddleware(http.HandlerFunc(h.HandleListUsers)).ServeHTTP(w, r)
}).Methods("GET")
```

---

## ✨ 주요 기능 상세

### 1. 사용자 목록 조회
- 모든 사용자 표시
- 역할별 필터링 (Admin/User)
- 검색 기능 (사용자명)
- 페이지네이션 (사용자가 많을 경우)
- 사용자별 리소스 사용량 요약 표시

### 2. 사용자 생성
- 사용자명, 비밀번호 입력
- 역할 선택 (User/Admin)
- 초기 Quota 설정 (선택적)
- 중복 사용자명 체크

### 3. 사용자 수정
- 사용자명 변경 (선택적)
- 역할 변경
- Quota 수정
- 비밀번호 변경 (선택적)

### 4. 사용자 삭제
- Soft delete (실제로는 비활성화)
- 삭제된 사용자의 VM 처리 정책 설정
- 복구 기능 (선택적)

### 5. 역할 변경
- User ↔ Admin 전환
- 확인 다이얼로그 (중요한 작업)
- 변경 이력 기록 (선택적)

### 6. Quota 설정
- 사용자별 개별 Quota 설정
- 시스템 전체 Quota와 별도 관리
- 실시간 사용량 표시

### 7. 사용자별 VM 목록
- 특정 사용자가 생성한 모든 VM 표시
- VM 상태, 리소스 사용량 표시
- VM 관리 액션 (시작/중지/삭제) - 선택적

### 8. 비밀번호 초기화
- Admin이 사용자 비밀번호 초기화
- 임시 비밀번호 생성
- 이메일 발송 (선택적, 향후 구현)

---

## 📊 예상 효과

### 관리 효율성
- **DB 직접 접근 불필요**: 웹에서 모든 작업 가능
- **빠른 사용자 관리**: 클릭 몇 번으로 완료
- **실수 방지**: UI에서 검증 및 확인

### 보안 강화
- **권한 관리 용이**: Admin 권한 부여/회수 쉬움
- **감사 추적**: 모든 관리 작업 기록 가능
- **접근 제어**: Admin만 접근 가능

### 리소스 관리
- **개별 Quota 설정**: 사용자별 맞춤 리소스 할당
- **사용량 모니터링**: 사용자별 리소스 사용 파악
- **최적화**: 리소스 사용 패턴 분석

---

## 🎯 추가 기능 아이디어

### 1. 사용자 그룹
- 여러 사용자를 그룹으로 묶기
- 그룹별 Quota 설정
- 그룹별 권한 관리

### 2. 사용자 활동 로그
- 로그인/로그아웃 기록
- VM 생성/삭제 기록
- 관리 작업 기록

### 3. 사용자 통계
- 사용자별 VM 개수
- 리소스 사용 추이
- 활동 시간대 분석

### 4. 대량 사용자 가져오기
- CSV 파일로 여러 사용자 한번에 생성
- LDAP/Active Directory 연동 (고급)

### 5. 사용자 초대 시스템
- 이메일로 초대 링크 발송
- 초대 코드로 회원가입
- 초대자 추적

---

## 🚀 구현 우선순위

### Phase 1 (필수)
1. 사용자 목록 조회
2. 사용자 생성
3. 사용자 삭제
4. 역할 변경

### Phase 2 (중요)
5. 사용자 수정
6. Quota 설정
7. 사용자별 VM 목록

### Phase 3 (선택)
8. 비밀번호 초기화
9. 사용자 검색/필터링
10. 사용자 통계

---

## 🎯 결론

**사용자 관리 UI**는 Admin이 웹 인터페이스에서 모든 사용자를 효율적으로 관리할 수 있게 해주는 기능입니다.

**주요 장점**:
1. 👥 **완전한 사용자 관리** (생성/수정/삭제)
2. 🔐 **권한 관리 용이** (역할 변경)
3. 📊 **리소스 관리** (개별 Quota 설정)
4. 🔍 **사용량 모니터링** (사용자별 VM 목록)
5. ⚡ **관리 효율성** (DB 직접 접근 불필요)

**비유**:
- 현재 = 사용자 관리하려면 DB에 직접 접속해서 SQL 실행
- 개선 후 = 웹 브라우저에서 클릭 몇 번으로 모든 사용자 관리

---

**작성일**: 2024년


---

## 관련 문서

- [Legacy 기록](./)

---

**태그**: `#아카이브` `#Legacy` `#기능-설명` `#과거-기록`

**카테고리**: 아카이브 > Legacy 기록 > 기능 설명

**상태**: 과거 기록

**마지막 업데이트**: 2024-12-23
