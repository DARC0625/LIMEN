# 방화벽 상태 확인 결과

## 확인 일시
2025-12-30

## 프론트엔드 서버 방화벽 상태

### 방화벽 도구
- **UFW**: 설치되지 않음 또는 비활성화
- **firewalld**: 설치되지 않음 또는 비활성화
- **iptables**: 확인 불가 (sudo 권한 필요)

### 리스닝 포트 확인
✅ **정상 작동 중인 포트:**
- **포트 80 (HTTP)**: 열려있음 - Envoy 프록시
- **포트 443 (HTTPS)**: 열려있음 - Envoy 프록시
- **포트 9444**: 열려있음 - Next.js 프론트엔드
- **포트 9445**: 열려있음 - darc.kr
- **포트 22 (SSH)**: 열려있음 - 관리용
- **포트 9901**: 열려있음 - Envoy 관리 인터페이스

### 네트워크 연결 테스트

#### 내부망 통신 (프론트엔드 → 백엔드)
✅ **백엔드 API (10.0.0.100:18443)**
- **ping**: 성공 (0% 패킷 손실)
- **HTTP 연결**: 성공 (200 OK)
- **TCP 연결**: 성공 (nc 테스트)

✅ **Agent 서비스 (10.0.0.100:9000)**
- **HTTP 연결**: 성공 (200 OK)
- **TCP 연결**: 성공 (nc 테스트)

#### 라우팅
✅ **내부망 라우팅**: 정상
- 경로: `10.0.0.100 dev enp1s0 src 10.0.0.10`
- 인터페이스: `enp1s0` (내부망)

## 현재 상태 요약

### ✅ 정상 작동
1. **외부 접근**: 포트 80, 443 정상 리스닝
2. **내부 서비스**: 포트 9444, 9445 정상 리스닝
3. **내부망 통신**: 백엔드(10.0.0.100)와 정상 통신
   - API (18443): 정상
   - Agent (9000): 정상

### ⚠️ 주의사항
1. **방화벽 비활성화 상태**: 
   - 현재 방화벽이 활성화되어 있지 않거나 모든 트래픽을 허용하는 상태
   - 보안을 위해 방화벽 설정 권장

2. **권장 방화벽 설정**:
   ```bash
   # UFW 사용 시
   sudo ufw default deny incoming
   sudo ufw default allow outgoing
   sudo ufw allow 80/tcp
   sudo ufw allow 443/tcp
   sudo ufw allow from 10.0.0.0/24 to any port 18443
   sudo ufw allow from 10.0.0.0/24 to any port 9000
   sudo ufw allow 22/tcp
   sudo ufw enable
   ```

## 백엔드 서버 방화벽 확인 필요

백엔드 서버에서도 다음을 확인해야 합니다:

1. **인바운드 규칙**:
   - 프론트엔드(10.0.0.10)에서 포트 18443 접근 허용
   - 프론트엔드(10.0.0.10)에서 포트 9000 접근 허용

2. **확인 명령어** (백엔드 서버에서 실행):
   ```bash
   sudo ufw status verbose
   # 또는
   sudo iptables -L -n -v
   
   # 리스닝 포트 확인
   sudo netstat -tuln | grep -E "18443|9000"
   
   # 프론트엔드에서 접근 테스트
   curl -v http://10.0.0.10:9444/api/health_proxy
   ```

## 중요 사항

### 현재 통신 경로
```
외부 사용자
  ↓ HTTPS/HTTP
프론트엔드 인터넷 IP (14.54.57.159:443/80)
  ↓ Envoy 프록시 (포트 80/443 리스닝)
Next.js 프론트엔드 (127.0.0.1:9444)
  ↓ Next.js Middleware
  ↓ 내부망 (10.0.0.10 → 10.0.0.100:18443, enp1s0 → eth1)
백엔드 API (10.0.0.100:18443, 리스닝: 0.0.0.0:18443)
```

### 방화벽 설정 권장사항

1. **프론트엔드 서버**:
   - 외부 접근: 포트 80, 443만 허용
   - 내부망 통신: 10.0.0.0/24 대역 허용
   - SSH: 특정 IP에서만 접근 허용 권장

2. **백엔드 서버**:
   - 내부망 접근: 프론트엔드(10.0.0.10)에서만 포트 18443, 9000 허용
   - 외부 접근: 필요시에만 허용 (프론트엔드가 프록시하므로 일반적으로 불필요)

## 다음 단계

1. ✅ **현재 상태**: 모든 통신 정상 작동
2. ⚠️ **보안 강화**: 방화벽 활성화 및 규칙 설정 권장
3. 📋 **백엔드 확인**: 백엔드 서버 방화벽 설정 확인 필요




